## Часть 1. Инструмент ipcalc

Запустить виртуальную машину (далее — ws1)

1.1 Сети и маски
Определите и запишите в отчете:
1) сетевой адрес `192.167.38.54/13`
![определение сетевого адреса](Part1.1.1%20Определение%20сетевого%20адреса.png)

2) Преобразование маски `255.255.255.0`  в префиксную и двоичную.
![преобразование маски](Part1.1.2%20Преобразование%20в%20префиксную%20и%20двоичную%20запись.png)
- Префиксная запись `/24`
- Двоичная маска `11111111.11111111.11111111.00000000`
 
 Маска `255.255.255.0` состоит из 24 единиц (первые три октета по 8 бит). `/24` - это количество единиц
 - Преобразование `/15` в обычную и двоичную.

   ![Преобразование /15 в обычную и двоичную](Part1.1.2%20Преобразование%20%20в%20обычную%20и%20двоичную%20маску..png)

- Обычная маска: `255.254.0.0`

- Двоичная маска: `11111111.11111110.00000000.00000000`

   `/15` означает 15 единиц подряд: Первый октет: `11111111` (8 бит),
второй октет: `11111110` (7 бит → 8 + 7 = 15),остальные октеты: 00000000.00000000.

  - Преобразование `11111111.11111111.11111111.11110000` в обычную и префиксную.
 
   не поддерживает прямой ввод двоичных масок в таком формате, поэтому преобразуем двоичную маску в десятиричную вручную.
   командой `echo "ibase=2;11110000" | bc` конвернируем каждый двоичный октет или используем онлайн-калькуляторы (например, [IP Calculator](https://www.calculator.net/ip-subnet-calculator.html) ). Получаем маску в виде `255.255.255.240`
![перевод из двоичной в десятиричную](Part1.1.2%20Перевод%20из%20двоичной%20записи%20в%20десятеричную.png)
Проверяем правильность перевода, а так же определяем префиксную маску командой `ipcalc 192.167.38.54 255.255.255.240`
- префиксная маска `/28`
![проверка перевода из двоичной в десятеричной](Part1.1.2%20Проверка%20перевода%20из%20двоичной%20системы.png)

3) минимальный и максимальный хост в сети 12.167.38.4 с масками: /8 , 11111111.11111111.00000000.00000000 , 255.255.254.0 и /4

  **Что такое хост?**

**Хост** — это устройство (компьютер, сервер, принтер и т.д.) в сети, которому присвоен уникальный IP-адрес.

**Минимальный хост** — первый доступный IP-адрес в подсети.

**Максимальный хост** — последний доступный IP-адрес перед широковещательным адресом (Broadcast).

**Как определить минимальный и максимальный хост?**

Для этого нужно:

- Найти **сетевой адрес** (Network) по IP и маске.
- Рассчитать диапазон допустимых хостов.

- **минимальный и максимальный хост в сети `12.167.38.4/8`**
![определение мах/мин хост 12.167.38.4/8 ](Part1.1.3%20махмин%20хост%208.png)
**Маска /8 (255.0.0.0)**

Шаги:

- **Сетевой адрес:**
Первые 8 бит фиксированы, остальные — нули. 12.167.38.4 → 12.0.0.0/8.

**Минимальный хост:** Первый адрес после сетевого: `12.0.0.1`.

**Максимальный хост:** Последний адрес перед Broadcast: `12.255.255.254`.


-  **минимальный и максимальный хост в сети `12.167.38.4` с маской `11111111.11111111.00000000.00000000`**

- Маска `11111111.11111111.00000000.00000000` или `255.255.0.0` или `/16`
![определение мах/мин хост 12.167.38.4/16 ](Part1.1.3%20maxmin%20host%2016.png)

**Сетевой адрес:** Первые 16 бит фиксированы: `12.167.0.0/16`.

**Минимальный хост:**`12.167.0.1`.

**Максимальный хост:**`12.167.255.254`.

- **минимальный и максимальный хост в сети 12.167.38.4 с маской 255.255.254.0**
**маска** `255.255.254.0` или `11111111.11111111.11111110.00000000` или `/23`
![определение мах/мин хост 23](Part1.1.3%20maxmin%20host%2023.png)

**Сетевой адрес:** `/23` означает, что первые 23 бита фиксированы.
`12.167.38.4 → 12.167.38.0/23`.

**Минимальный хост:**`12.167.38.1`.

**Максимальный хост:**`12.167.39.254`.

- **минимальный и максимальный хост в сети 12.167.38.4/4**
**Маска** `/4` или `(240.0.0.0)`
![определение мах/мин хост 12.167.38.4/4](Part1.1.3%20maxmin%20host%204.png)

**Сетевой адрес:**Первые 4 бита фиксированы.
`12.167.38.4 → 0.0.0.0/4` (так как 12 в двоичном виде: 00001100, первые 4 бита — 0000).

**Минимальный хост:**  `0.0.0.1`.

**Максимальный хост:** `15.255.255.254`

 **1.2. localhost**

Определи и запиши в отчёт, можно ли обратиться к приложению, работающему на localhost, со следующими IP: 194.34.23.100, 127.0.0.2, 127.1.0.1, 128.0.0.1

**localhost** (или `127.0.0.1`) — это специальный IP-адрес, который всегда указывает на текущий компьютер. Все адреса в диапазоне `127.0.0.0/8` (от `127.0.0.1` до `127.255.255.254`) зарезервированы для loopback-интерфейса, то есть они направляют трафик обратно на сам хост.
![определения диапазона адресов входящих localhost](Part1.2%20определение%20диапазона%20адресов%20входящих%20localhost.png)

- адреса `127.0.0.2`, `127.1.0.1` входят диапазон от `127.0.0.1` до `127.255.255.254` следовательно могут обратиться к приложению на **localhost**
- адреса `194.34.23.100` , `128.0.0.1` - невходят диапазон от `127.0.0.1` до `127.255.255.254` следовательно немогут обратиться к приложению на **localhost**.

**1.3. Диапазоны и сегменты сетей**

Определи и запиши в отчёт:
1) Какие из перечисленных IP можно использовать в качестве публичного, а какие только в качестве частных: 10.0.0.45, 134.43.0.2, 192.168.4.2, 172.20.250.4, 172.0.2.1, 192.172.0.1, 172.68.0.2, 172.16.255.255, 10.10.10.10, 192.169.168.1

- **Публичный IP-адрес** - Уникальный адрес в глобальной сети Интернет.
Использование: Маршрутизируется через Интернет, используется для взаимодействия устройств за пределами локальной сети.

- **Частный IP-адрес** - Адрес, используемый внутри локальной сети (домашней, офисной).
Использование: Не маршрутизируется в Интернете, предназначен для внутренней коммуникации.

Диапазоны:

`10.0.0.0/8` (`10.0.0.0` – `10.255.255.255`)

`172.16.0.0/12` (`172.16.0.0` – `172.31.255.255`)

`192.168.0.0/16` (`192.168.0.0` – `192.168.255.255`)

Если **ip** адрес входит в `10.x.x.x`, `172.16.x.x` – `172.31.x.x` или `192.168.x.x` → **частный**.

Все остальные → **публичные**.
**Анализ IP-адресов:**

`10.0.0.45` - Частный. Входит в диапазон `10.0.0.0/8`.

`134.43.0.2` - Публичный. Не относится к частным диапазонам.

`192.168.4.2` - Частный. Входит в диапазон `192.168.0.0/16`.

`172.20.250.4`- Частный. Входит в диапазон `172.16.0.0/12` (16 ≤ 20 ≤ 31).

`172.0.2.1` - Публичный. Не относиться диапазон `172.16.0.0/12` начинается с `172.16.0.0`.

`192.172.0.1` - Публичный. Не входит в `192.168.0.0/16` (только `192.168.x.x`).

`172.68.0.2` - Публичный.Вне диапазона `172.16.0.0/12` (68 > 31).

`172.16.255.255` - Частный. Входит в диапазон `172.16.0.0/12`. Это широковещательный адрес подсети.

`10.10.10.10` - Частный. Входит в диапазон `10.0.0.0/8`.

`192.169.168.1`- Публичный. Вне диапазона `192.168.0.0/16` (169 ≠ 168).



2) Какие из перечисленных IP-адресов шлюза возможны у сети 10.10.0.0/18: 10.0.0.1, 10.10.0.2, 10.10.10.10, 10.10.100.1, 10.10.1.255
![определяем диапазон сети 10.10.0.0/18](Part1.3%20maxmin%20host%20сети%2018.png)

Определение диапазона сети `10.10.0.0/18`
Сетевой адрес: `10.10.0.0/18`.

Маска: `255.255.192.0` (префикс /18).
Д
апазон хостов:

HostMin: 10.10.0.1.

HostMax: 10.10.63.254.

Broadcast: 10.10.63.255.

 Проверка предложенных IP-адресов:
Шлюз должен находиться внутри диапазона HostMin–HostMax и не совпадать с Broadcast.

`10.0.0.1` - Неподходит.Вне диапазона `10.10.0.0/18`. Сеть `10.10.0.0/18` начинается с `10.10.0.0`.

`10.10.0.2` - Подходит.Входит в диапазон `10.10.0.1`–`10.10.63.254`.

`10.10.10.10`- Подходит. Входит в диапазон `10.10.0.1`–`10.10.63.254`.

`10.10.100.1` - Неподходит. Вне диапазона (максимальный адрес в сети — `10.10.63.254`).

`10.10.1.255` - Подходит. Входит в диапазон. Это не Broadcast (Broadcast — `10.10.63.255`).
## Part 2. Статическая маршрутизация между двумя машинами

Клонируем первую машину ws1 и создаем из нее ws2.
- Для каждой машины в настройках сети подключаем 2 адаптер Внутренняя сеть (Internal Network), это важно что бы обе машины были в одной сети и могли общаться.
![подключение 2 сетевого адаптера](Part2.подключение%202%20сетевого%20адаптера.png)

- `ip a` смотрим сушествующие сетевые интерфейсы.
![существующие сетевые интерфейсы](Part2.%20cуществующие%20сетевые%20интерфейсы.png) 

Сетевой интерфейс - это "виртуальный порт", через который компьютер подключается к сети. В Linux интерфейся обычно называются: `eth0, eth1, enp0s3, enp0s8`.

`lo` — `loopback` (виртуальный интерфейс для локальных задач).

`enp0s3, enp0s8` — физический/виртуальный интерфейс для подключения к сети.
- Настройка `ws1` `192.168.100.10/16 и ws2 — 172.24.116.8/12`  - редактируем конфиг Netplan
`sudo nano /ect/netplan/00-installer-config.yaml`
![cодержание изменённого файла etc/netplan/00-installer-config.yaml для каждой машины](Part2.cодержание%20изменённого%20файла%20etc%20netplan%2000-installer-config.yaml%20для%20каждой%20машины.png)

Выполняем команду `netplan apply` для перезапуска сервиса сети.

проверяем что настройки применились `ip a`
![новые настройки ip](Part2.новые%20настроки%20интерфейсов.png)
- ### 2.1 Добавление статического маршрута вручную
Добавь статический маршрут от одной машины до другой и обратно при помощи команды вида `ip r add`.
- ![Добавление статического маршрута вручную](Part2.1%20Добавление%20статического%20маршрута%20вручную.png)

Пропингуем соединение между машинами `ping -c 3 172.24.116.8 и ping -c 3 192.168.100.10`
 - ![пингуем соединение между машинами](Part2.1%20пропинговка%20ws1%20и%20ws2.png)
- ### 2.2. Добавление статического маршрута с сохранением
Перезапускаем машины `reboot`.

Добавь статический маршрут от одной машины до другой с помощью файла /etc/netplan/00-installer-config.yaml.
![Добавление статического маршрута с сохранением](Part2.2%20Добавление%20статического%20маршрута%20с%20сохранением.png)

 - `to` и `via` — это параметры, используемые при настройке статических маршрутов в сетях.
  - `to (куда?)` Целевая сеть или IP-адрес, куда нужно направить трафик.
Как работает: Если `to` указывает на подсеть (например, 172.16.0.0/12), маршрут применяется ко всем IP-адресам в этой подсети.
Если `to` указывает на конкретный IP (например, 192.168.1.5/32), маршрут работает только для этого адреса.
 - `via (через кого?)` IP-адрес шлюза (роутера или другого устройства), через который трафик попадает в целевую сеть (`to`).Как работает: Шлюз должен находиться в той же сети, что и устройство, на котором настраивается маршрут.
Если шлюз недоступен, трафик не дойдет до цели.
 - 
 
 ### Пропингуй соединение между машинами. 
 `ping -c 3 172.24.116.8 и ping -c 3 192.168.100.10`
 ![проверка соединения `ping -c 3 172.24.116.8 и ping -c 3 192.168.100.10`](Part2.2%20%20`ping%20-c%203%20172.24.116.8%20и%20ping%20-c%203%20192.168.100.10`.png)

## Part 3. Утилита iperf3

### 3.1. Скорость соединения
Переведи и запиши в отчёт: 8 Mbps в MB/s, 100 MB/s в Kbps, 1 Gbps в Mbps.

8 Mbps = 1 MB/s

100 MB/s = 800000 Kbps

1 Gbps = 1000 Mbps

Mbps = мегабит в секунду, MB/s = мегабайт в секунду, Kbps = килобит в секунду.
### 3.2. Утилита iperf3
Измерь скорость соединения между ws1 и ws2.

*perf3*  — это программа для измерения пропускной способности сети в реальном времени.Является одним из инструментов для тестирования максимально достижимой пропускной способности в IP-сетях (поддерживает IPv4 и IPv6).
Чтобы протестировать пропускную способность сети, сначала нужно подключиться к удаленной машине, которую ты будешь использовать в качестве сервера, и запустить iperf3 в режиме сервера с помощью флага -s. По умолчанию он будет прослушивать порт 5201.

Запускаем сервер на **ws2** `ipepf3 -s`, на **ws1** запускаем клиент `iperf -c 172.24.116.8`
![Измерение скорости ](Part3.2%20ws%20Измерение%20скорости%20%20iperf3.png)

Запускаем сервер на **ws1** `ipepf3 -s`, на **ws2** запускаем клиент `iperf -c 192.168.100.10`

![измерение скорости](Part3.2%20Измерение%20скорости%20%20iperf3.png)

## Part 4. Сетевой экран

### 4.1. Утилита iptables
Создай файл **/etc/firewall.sh**, имитирующий файрвол, на **ws1** и **ws2**:

 Удаление всех правил в таблице «filter» (по умолчанию).

`iptables -F` - Флаг --flush - полностью очищает все правила в выбранной цепочке (по умолчанию в таблице filter).

`iptables -X` -  Флаг --delete-chain - удаляет все пользовательские (нестандартные) цепочки правил.

     Нужно добавить в файл подряд следующие правила:
1) На ws1 примени стратегию, когда в начале пишется запрещающее правило, а в конце пишется разрешающее правило (это касается пунктов 4 и 5).
2) На ws2 примени стратегию, когда в начале пишется разрешающее правило, а в конце пишется запрещающее правило (это касается пунктов 4 и 5).
3) Открой на машинах доступ для порта 22 (ssh) и порта 80 (http).
4) Запрети echo reply (машина не должна «пинговаться», т. е. должна быть блокировка на OUTPUT).
5) Разреши echo reply (машина должна «пинговаться»).
![ Утилита iptables](Part4.1%20Утилита%20iptables.png)
           
       iptables -A INPUT -p tcp --dport 22 -j ACCEPT
- `- A INPUT`: Добавить правило в цепочку `INPUT` (для входящих пакетов).

 - `-p tcp`: Протокол `TCP`.

- `--dport 22`: Destination port 22 (порт SSH).
- `--dport 80`: Destination port 80 (порт HTTP).

- `-j ACCEPT`: Разрешить пакет.
 
      iptables -A OUTPUT -p icmp --icmp-type echo-reply -j DROP

- `-A OUTPUT`: Append (добавить правило) в конец цепочки OUTPUT (для исходящих пакетов).

- `-p icmp`: Протокол ICMP (используется для ping).

- `--icmp-type echo-reply`: Конкретный тип ICMP-пакета - ответ на ping.

- `-j DROP (--jump DROP)`: Действие — отбросить пакет без уведомления отправителя.
- `-j ACCEPT`: Действие — принять пакет.



Запусти файлы на обеих машинах командами chmod +x /etc/firewall.sh и /etc/firewall.sh.
![запуск фаервола](Part4.1%20запуск%20фаервола.png)
Стратегия для **ws1** "Запрет → Разрешение", для **ws2** "Разрешение → Запрет"

 Принцип работы *iptables*:

- Правила обрабатываются последовательно сверху вниз

- При совпадении пакета с правилом:

     - Применяется указанное действие (ACCEPT/DROP)

     - Обработка прекращается - последующие правила игнорируются

- Если пакет не совпал ни с одним правилом - применяется политика по умолчанию (обычно ACCEPT)
### 4.2. Утилита nmap
Командой ping найди машину, которая не «пингуется», после чего утилитой nmap покажи, что хост машины запущен.
![Командой ping ищем машину, которая не «пингуется»](Part4.2%20Команда%20ping%20,поиск%20машины%20которая%20%20не%20«пингуется».png)
Проверка: в выводе nmap должно быть сказано: Host is up.
![Проверка: в выводе nmap](Part4.2%20Проверка%20в%20выводе%20nmap.png)
## Part 5. Статическая маршрутизация сети
![задание part5](Part5.png)
 Подними пять виртуальных машин (3 рабочие станции (ws11, ws21, ws22) и 2 роутера (r1, r2)).
### 5.1. Настройка адресов машин

Настрой конфигурации машин в etc/netplan/00-installer-config.yaml согласно сети на рисунке.
 
 Настроки `ws11`,`ws21` и `ws22`
 ![настрока конфигурации машин ws11, ws21, ws22 ](Part5.1настрока%20конфигурации%20машин%20ws11,%20ws21,%20ws22.png )

 Настроки `r1` и `r2`
 ![астроки r1 и r2](Part%205.1%20настроки%20r1%20и%20r2.png)




Перезапусти сервис сети. Если ошибок нет, командой ip -4 a проверь, что адрес машины задан верно.

Перезапуск сервиса и проверка `ip -4 a` для  `ws1`,`ws21` и `ws22`
![Перезапуск сервиса и проверка ip -4 a для ws1,ws21 и ws22](Part5.1Перезапуск%20сервиса%20и%20проверка%20ip%20-4%20a%20для%20ws1,ws21%20и%20ws22.png)

Перезапуск сервиса и проверка `ip -4 a` для  `r1` и `r2`
![Перезапуск сервиса и проверка `ip -4 a` для  `r1` и `r2`](Part5.1%20Перезапуск%20сервиса%20и%20проверка%20ip%20-4%20a%20для%20%20r1%20и%20r2.png)

 Также пропингуй ws22 с ws21. Аналогично пропингуй r1 с ws11.
В отчёт помести скрины с вызовом и выводом использованных команд.
![пинг ws22 с ws21](Part5.1%20пропингуй%20ws22%20с%20ws21.png)

![пинг ws11 с r1](Part5.1%20пинг%20ws11%20с%20r1.png)

### 5.2. Включение переадресации IP-адресов

Для включения переадресации IP выполни команду на роутерах:
`sysctl -w net.ipv4.ip_forward=1` При таком подходе переадресация не будет работать после перезагрузки системы.
![Включение переадресации IP-адресов,временное](Part%205.2%20Включение%20переадресации%20IP-адресов(временное).png)


Открой файл **/etc/sysctl.conf** и добавь в него следующую строку:
`net.ipv4.ip_forward = 1` При использовании этого подхода, IP-переадресация включена на постоянной основе.
![Постоянная переадресация](Patr5.2%20Постоянная%20переадресация.png)

### 5.3. Установка маршрута по умолчанию
Пример вывода команды `ip r` после добавления шлюза:
```
default via 10.10.0.1 dev eth0
10.10.0.0/18 dev eth0 proto kernel scope link src 10.10.0.2
```
##### Настрой маршрут по умолчанию (шлюз) для рабочих станций. Для этого добавь `default` перед IP-роутера в файле конфигураций.
![маршрут по умолчанию (шлюз)](Part5.3%20маршрут%20по%20умолчанию%20(шлюз)r1r2.png)
![маршрут по умолчанию (шлюз)wsки](Part5.3маршрут%20по%20умолчанию%20(шлюз)ws11,ws21,ws22.png)

##### Вызови `ip r` и покажи, что добавился маршрут в таблицу маршрутизации.
![Вызов ip r](Part5.3%20Вызов%20ip%20r.png)
![Вызови ip r для r1,r2](Part5.3%20Вызов%20ip%20r%20%20для%20r1%20и%20r2.png)

##### Пропингуй с ws11 роутер r2 и покажи на r2, что пинг доходит. Для этого используй команду:
`tcpdump -tn -i eth0`
![пинг с ws11 роутер r2](Part5.3%20пинг%20с%20ws11%20роутер%20r2.png)
#### 5.4. Добавление статических маршрутов
##### Добавь в роутеры r1 и r2 статические маршруты в файле конфигураций. Пример для r1 маршрута в сетку 10.20.0.0/26:
```shell
# Добавь в конец описания сетевого интерфейса eth1:
- to: 10.20.0.0
  via: 10.100.0.12
```
- ![Добавьте статические маршруты к r1 и r2](Part5.4%20Добавьте%20статические%20маршруты%20к%20r1%20и%20r2.png)
##### Вызови `ip r` и покажи таблицы с маршрутами на обоих роутерах. Пример таблицы на r1:
```
10.100.0.0/16 dev eth1 proto kernel scope link src 10.100.0.11
10.20.0.0/26 via 10.100.0.12 dev eth1
10.10.0.0/18 dev eth0 proto kernel scope link src 10.10.0.1
```
- ![ip rи покажите таблицы маршрутизации на обоих маршрутизаторах](Part5.4%20Добавьте%20статические%20маршруты%20к%20r1%20и%20r2.png)
##### Запусти команды на ws11:
`ip r list 10.10.0.0/[маска сети]` и `ip r list 0.0.0.0/0`
![ip r list 10.10.0.0/[маска сети] и ip r list 0.0.0.0/0](Part5.4%20ip%20r%20list%2010.10.0.0%20маска%20сети%20и%20ip%20r%20list%200.0.0.0%200.png)
Показывает конкретный маршрут для указанной сети
`10.10.0.0/18 dev enp0s8 proto kernel scope link src 10.10.0.2` 
- В данном случае:

- `dev enp0s8` → трафик идет через интерфейс enp0s8

- `proto kernel` → маршрут добавлен автоматически ядром

- `scope link` → действует только в локальной сети

- `src 10.10.0.2` → исходящий IP-адрес

Показывает маршрут по умолчанию (для всех адресов, не попадающих под другие правила) `ip r list 0.0.0.0/0`
 `default via 10.10.0.1 dev enp0s8`
 Что показывает:

- default → маршрут по умолчанию

- via 10.10.0.1 → шлюз для этого маршрута

- dev enp0s8 → интерфейс для отправки трафика

- Для сети `10.10.0.0/18` используется специальный маршрут через локальный интерфейс, а не маршрут по умолчанию, потому что система маршрутизации всегда выбирает наиболее специфичный доступный маршрут (с наибольшей длиной маски), и в данном случае /18 (18 бит) является более точным соответствием, чем /0 (0 бит), что обеспечивает прямую доставку пакетов внутри подсети без ненужного перенаправления через шлюз.

#### 5.5. Построение списка маршрутизаторов
Пример вывода утилиты **traceroute** после добавления шлюза:
```
1 10.10.0.1 0 ms 1 ms 0 ms
2 10.100.0.12 1 ms 0 ms 1 ms
3 10.20.0.10 12 ms 1 ms 3 ms
```
##### Запусти на r1 команду дампа:
`tcpdump -tnv -i enp0s8`
##### При помощи утилиты **traceroute** построй список маршрутизаторов на пути от ws11 до ws21.
![использованных команд (tcpdump и traceroute)](Part5.5%20использованных%20команд%20(tcpdump%20и%20traceroute).png)
Путь строиться от узла к узлу до того момента, покаа не будет достигнута конечная точка. Каждый пакет проходит на своем пути определенное количество узлов, пока достигнет своей цели. На каждом узле добавляется счетчик, который отслеживает количество пройденых узлов.

#### 5.6. Использование протокола **ICMP** при маршрутизации
##### Запусти на r1 перехват сетевого трафика, проходящего через eth0 с помощью команды:
`tcpdump -n -i eth0 icmp`
##### Пропингуй с ws11 несуществующий IP (например, *10.30.0.111*) с помощью команды:
`ping -c 1 10.30.0.111`
![перехват сетевого трафика](Part5.6%20перехват%20сетевого%20трафика.png)
## Part 6. Динамическая настройка IP с помощью **DHCP**

**== Задание ==**
##### Для r2 настрой в файле */etc/dhcp/dhcpd.conf* конфигурацию службы **DHCP**:
##### 1) Укажи адрес маршрутизатора по умолчанию, DNS-сервер и адрес внутренней сети. Пример файла для r2:
```shell
subnet 10.100.0.0 netmask 255.255.0.0 {}

subnet 10.20.0.0 netmask 255.255.255.192
{
    range 10.20.0.2 10.20.0.50;
    option routers 10.20.0.1;
    option domain-name-servers 10.20.0.1;
}
```

![Конфигурация DHCP-сервера /etc/dhcp/dhcpd.conf](Part6.%20Конфигурация%20DHCP-сервера%20etc%20dhcp%20dhcpd.conf.png)
##### 2) В файле *resolv.conf* пропиши `nameserver 8.8.8.8`.
![файл resolv.conf nameserver 8.8.8.8](Part6.%20файл%20resolv.conf%20nameserver%208.8.8.8.png)
##### Перезагрузи службу **DHCP** командой `systemctl restart isc-dhcp-server`. Машину ws21 перезагрузи при помощи `reboot` и через `ip a` покажи, что она получила адрес. Также пропингуй ws22 с ws21.
![ws21 перезагрузка при помощи reboot](Part6.%20ws21%20перезагрузка%20при%20помощи%20reboot.png)

![ПерезагрузкаDHCP и ip a для ws21](Part6.ПерезагрузкаDHCP%20и%20ip%20a%20для%20ws21.png)
 - После вывода `ip a` мы видим что динамическмй `ip` адресс не присвоился, что логично ведь в настройках `netplan` мы умышленно указывали не использовать службу DHCP.
 - Изменим настройки файла `etc/netplan/00-installer-config.yaml` для `ws21 и ws2`
![dhcp true для ws21/22](Part6.%20настройки%20нетплан%20для%20ws21и22%20dhcp%20true.png) 

Командами 
sudo dhclient -r enp0s8 - освобождаем IP адресс интерфейса enp0s8
sudo dhclient enp0s8 -  запускаем получеие нового.
проверяем наши IP адресса командой `ip a show enp0s8`
![динамические IP адрема для ws21/22](Part6.динамические%20IP%20адрема%20для%20ws21и22.png)
Пингуем `ws21 к ws22`
![Пингуем `ws21 к ws22`](Part6.%20Пингуем%20ws21%20к%20ws22..png)

##### Укажи MAC-адрес у ws11, для этого в *etc/netplan/00-installer-config.yaml* надо добавить строки: `macaddress: 10:10:10:10:10:BA`, `dhcp4: true`.
![MAC-адрес у ws11](Part6.%20MAC%20адрес%20у%20ws11.png)
Удалили статический адресс.
 применяем настройки командой `sudo netplan apply`  и видим что мак адресс не применился.
 ![мак адресс не применился](Part6.%20мак%20адресс%20не%20применился.png)
 
##### Для r1 настрой аналогично r2, но сделай выдачу адресов с жесткой привязкой к MAC-адресу (ws11). Проведи аналогичные тесты.
- Настройка DHCP на R1 с резервацией для ws11
![Настройка DHCP на R1 с резервацией для WS11](Part6.%20Настройка%20DHCP%20на%20R1%20с%20резервацией%20для%20WS11%20.png)

`subnet 10.100.0.0` - декларация сети между роутерами (без выдачи адресов)

`subnet 10.10.0.0` - основная подсеть для клиентов

`range` - пул адресов для динамической выдачи

`option routers` - шлюз для клиентов (адрес R1)

`option domain-name-servers` - DNS-сервер для клиентов

`host ws11` - секция резервации адреса

`hardware ethernet` - MAC-адрес устройства

`fixed-address` - постоянный IP для этого MAC
 
 Настройка DNS на R1  `sudo nano /etc/resolv.conf`
 ![настройка DNS на R1](Part6.2%20астройка%20DNS%20на%20R1.png)
- Перезапуск службы DHCP для r1
![Перезапуск службы DHCP для r1](Part6.%20Перезапуск%20службы%20DHCP%20для%20r1.png) 


##### Запроси с ws21 обновление IP-адреса.
- Выполняем перезагрузку вм ws21
 ![Выполняем перезагрузку вм ws21](Part6.2%20перезагрузка%20dv%20ws1.png)

 IP адресс до обновления: `ip a show enp0s8`
 ![IP адресс до обновления](Part6.2%20IP%20адресс%20до%20обновления.png)
 IP адресс после обновления: `sudo dhclient -r enp0s8` - `sudo dhclient enp0s8` - `ip a show enp0s8`
 ![IP адресс после обновления](Part6.2%20IP%20адресс%20после%20обновления.png)
 - `sudo dhclient -r enp0s8`  -  освобождает IP адресс.

 - `sudo dhclient enp0s8` - Запрашивает новый IP адресс. 

 Проверка пинга с ws21 на ws22
 ![Проверка пинга с ws21 на ws22](Part6.2%20Проверка%20пинга%20с%20ws21%20на%20ws22.png)

## Part 7. **NAT**


**== Задание ==**

##### В файле */etc/apache2/ports.conf* на ws22 и r1 измени строку `Listen 80` на `Listen 0.0.0.0:80`, то есть сделай сервер Apache2 общедоступным.
- ![сервер Apache2 общедоступным измени строку Listen 80 на Listen 0.0.0.0:80](Part7.сервер%20Apache2%20общедоступным.png)
- По умолчанию Apache слушает только локальные подключения (127.0.0.1). Эта настройка позволяет принимать подключения со всех сетевых интерфейсов

##### Запусти веб-сервер Apache командой `service apache2 start` на ws22 и r1.
- ![Запускаем Apache на обеих машинах](Part7.%20Запускаем%20Apache%20на%20обеих%20машинах.png)
##### Добавь в фаервол, созданный по аналогии с фаерволом из Части 4, на r2 следующие правила:
##### 1) Удаление правил в таблице filter — `iptables -F`;
##### 2) Удаление правил в таблице «NAT» — `iptables -F -t nat`;
##### 3) Отбрасывать все маршрутизируемые пакеты — `iptables --policy FORWARD DROP`.
![Добавь в фаервол,на r2](Part7.%20добавь%20в%20фаервол,на%20r2.png)
##### Запусти файл также, как в Части 4.
![Запусти фаервола](Part7.%20запуск%20фаервола.png)
##### Проверь соединение между ws22 и r1 командой `ping`.
![соединение между ws22 и r1 командой `ping`](Part7.%20соединение%20между%20ws22%20и%20r1%20командой%20`ping.png)
*При запуске файла с этими правилами, ws22 не должна «пинговаться» с r1.*

##### Добавь в файл ещё одно правило:
##### 4) Разрешить маршрутизацию всех пакетов протокола **ICMP**.
![Разрешить маршрутизацию всех пакетов протокола **ICMP**](Part7.Разрешить%20маршрутизацию%20всех%20пакетов%20протокола%20ICMP.png)
##### Запусти файл также, как в Части 4.
![Запуск фаервола после добавления 4 правила](Part7.%20запуск%20фаервола%20после%204%20правила.png)
##### Проверь соединение между ws22 и r1 командой `ping`.
![Проверь соединение между ws22 и r1 командой `ping`.](Part7.%20проверка%20соединения%20ws22%20c%20r1.%20после%20добавления%204%20правила%20fw.png)
*При запуске файла с этими правилами, ws22 должна «пинговаться» с r1.*


##### Добавь в файл ещё два правила:
##### 5) Включи **SNAT**, а именно маскирование всех локальных IPиз локальной сети, находящейся за r2 (по обозначениям из Части 5 — сеть 10.20.0.0).
*Совет: стоит подумать о маршрутизации внутренних пакетов, а также внешних пакетов с установленным соединением.*



##### 6) Включи **DNAT** на 8080 порт машины r2 и добавить к веб-серверу Apache, запущенному на ws22, доступ извне сети.
*Совет: стоит учесть, что при попытке подключения возникнет новое tcp-соединение, предназначенное ws22 и 80 порту.*
![5 и 6 правило ](Part7.%205%20и%206%20праило%20FW.png)
##### Запусти файл также, как в Части 4.
![Запуск FW c правилами 5и6](Part7.%20Запуск%20FW%20c%20правилами%205и6.png)
*Перед тестированием рекомендуется отключить сетевой интерфейс **NAT** (его наличие можно проверить командой `ip a`) в VirtualBox, если он включен.*

##### Проверь соединение по TCP для **SNAT**: для этого с ws22 подключиться к серверу Apache на r1 командой:
`telnet [адрес] [порт]`
![соединение по TCP для SNAT](Part%207.%20соединение%20по%20TCP%20для%20SNAT.png)
##### Проверь соединение по TCP для **DNAT**: для этого с r1 подключиться к серверу Apache на ws22 командой `telnet` (обращаться по адресу r2 и порту 8080).
 ![соединение по TCP для DNAT](Part7.%20соединение%20по%20TCP%20для%20DNAT.png)

## Part 8. Дополнительно. Знакомство с **SSH Tunnels**
**== Задание ==**


##### Запусти на r2 фаервол с правилами из Части 7.
![Запуск на r2 фаервол с правилами из Части 7](Part8.Запусrк%20на%20r2%20фаервол%20с%20правилами%20из%20Части%207.png)
##### Запусти веб-сервер **Apache** на ws22 только на localhost (то есть в файле */etc/apache2/ports.conf* измени строку `Listen 80` на `Listen localhost:80`).
![веб-сервер **Apache** на ws22 только на localhost](Part8.%20веб-сервер%20Apache%20на%20ws22%20только%20на%20localhost.png)
Перезапуск Apache на ws22
![перезапуск Apache** на ws22](Part8.gерезапуск%20Apache%20на%20ws22.png)
##### Воспользуйся *lLoca TCP forwarding* с ws21 до ws22, чтобы получить доступ к веб-серверу на ws22 с ws21.
![Loca TCP forwarding](Part8.%20Loca%20TCP%20forwarding.png)
![вывод Loca TCP forwarding](Part8.вывод%20Loca%20TCP%20forwarding.png)
- `ssh -L 10021:10.20.0.25:80 ws22` - 

`-L 10021:10.20.0.25:80` - проброс локального порта 10021 на ws21 к порту 80 на ws22

##### Воспользуйся *Remote TCP forwarding* c ws11 до ws22, чтобы получить доступ к веб-серверу на ws22 с ws11.
![Remote TCP forwarding](Part8.Remote%20TCP%20forwarding.png)
![ вывод Remote TCP forwarding](Part8.Вывод%20Remote%20TCP%20forwarding.png)

##### Для проверки, сработало ли подключение в обоих предыдущих пунктах, перейди во второй терминал (например, клавишами Alt + F2) и выполни команду:
`telnet 127.0.0.1 [локальный порт]`
![проверки, сработало ли подключение](Part8.%20проверки,%20сработало%20ли%20подключение.png)